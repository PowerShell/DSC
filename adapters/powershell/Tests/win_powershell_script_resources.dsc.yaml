# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

$schema: https://aka.ms/dsc/schemas/v3/bundled/config/document.json
parameters:
  SafemodeAdministratorPassword:
    type: string
  showSecrets:
    type: bool
    defaultValue: true
  cred:
    type: secureObject
metadata:
  Microsoft.DSC:
    requiredSecurityContext: elevated # this is the default and just used as an example indicating this config works for admins and non-admins
resources:
- name: Use class PowerShell resources
  type: Microsoft.Windows/WindowsPowerShell
  properties:
    resources:
      - name: Windows Features Install ADS
        type: PSDesiredStateConfiguration/WindowsFeature
        properties:
          ensure: Present
          name: AD-Domain-Services
      - name: Windows Features Install ADS RSAT
        type: PSDesiredStateConfiguration/WindowsFeature
        properties:
          ensure: Present
          name: RSAT-AD-PowerShell
          dependsOn: 
          - "[resourceId('PSDesiredStateConfiguration/WindowsFeature','Windows Features Install ADS')]"
      - name: Active Directory Forest
        type: ActiveDirectoryDsc/ADDomain
        properties: 
          DomainName: contoso.com    
          Credential: 
            Username: "[parameters('cred').username]"
            Password: "[parameters('cred').password]"
          SafemodeAdministratorPassword: 
            Username: "[parameters('cred').username]"
            Password: "[parameters('cred').password]" 
          ForestMode: WinThreshold
- name: secureObject
  type: Microsoft.DSC.Debug/Echo
  properties:
    output: "[parameters('cred')]" 
    showSecrets: "[parameters('showSecrets')]"